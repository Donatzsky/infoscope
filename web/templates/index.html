<!DOCTYPE html>
<html>
<head>
    <title>{{ .Title }}</title>
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: #121a2b;
            color: #7da9b7;
            margin: 0;
            padding: 20px;
        }

        .header-link, .footer-link {
            display: block;
            color: #7da9b7;
            text-decoration: none;
            margin: 20px 0;
            text-align: center;  /* Add this line */
        }

        .return {
            text-decoration: none;
            color: #7da9b7;
        }

        h1 {
            color: #c4d3cb;
            text-align: center;
        }

        .feed {
            max-width: 960px;
            margin: 0 auto;
        }

        .entry {
            display: grid;
            grid-template-columns: auto auto 1fr auto;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
        }

        .favicon {
            height: 1em;
            width: 1em;
        }

        .link-container a {
            color: #a5c5cf;
            text-decoration: none;
            font-weight: bold;
        }

        .dots {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: clip;
        }

        .date {
            color: #7da9b7;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
        }

        .footer-image {
            margin: 20px 0;
            text-align: center;
        }

        .footer-image img {
            display: block;
            margin: 0 auto;
            height: {{ .FooterImageHeight }};
            width: auto;
            max-width: 100%;
        }

        @media (max-width: 600px) {
            .entry {
                grid-template-columns: auto auto 1fr;
                grid-template-rows: auto auto;
            }

            .link-container {
                grid-row: 1;
                grid-column: 2 / span 2;
            }

            .dots {
                display: none;
            }

            .date {
                grid-row: 2;
                grid-column: 2 / span 2;
            }
        }
    </style>
    <script>
    function getCSRFToken() {
        const meta = document.querySelector('meta[name="csrf-token"]');
        return meta ? meta.content : null;
    }

    function trackClick(entryId, url) {
        const csrfToken = getCSRFToken();
        if (!csrfToken) {
            console.error('CSRF token not found');
            return true; // Allow link to open even if tracking fails
        }

        fetch('/click?id=' + entryId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': csrfToken
            },
            credentials: 'include' // Include cookies
        }).catch(console.error);

        // Open the link in a new tab
        window.open(url, '_blank');
        return false; // Prevent default link behavior
    }
    </script>
</head>
<body>
    <h1>{{ .Title }}</h1>
    <a href="{{ .HeaderLinkURL }}" class="header-link return">{{ .HeaderLinkText }}</a>
    <div class="feed">
        {{ range .Entries }}
        <div class="entry">
            <img class="favicon" src="{{ .FaviconURL }}" alt="favicon">
            <div class="link-container">
                <a href="{{ .URL }}" onclick="return trackClick({{ .ID }}, '{{ .URL }}')" target="_blank">{{ .Title }}</a>
            </div>
            <span class="dots">......................................................................</span>
            <span class="date">{{ .Date }}</span>
        </div>
        {{ end }}
    </div>
    <div class="footer">
        {{ if .FooterImageURL }}
        <div class="footer-image">
            <img src="/static/images/{{ .FooterImageURL }}" alt="Footer image">
        </div>
        {{ end }}
        <a href="{{ .FooterLinkURL }}" class="footer-link return">{{ .FooterLinkText }}</a>
    </div>
    {{ if .TrackingCode }}
        {{ .TrackingCode | safeHTML }}
    {{ end }}
</body>
</html>